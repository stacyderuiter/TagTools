<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Plots and cropping • tagtools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Plots and cropping">
<meta property="og:description" content="tagtools">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tagtools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Detectors.html">Detectors</a>
    </li>
    <li>
      <a href="../articles/TagTools.html">Tagtools vignettes: overview and introduction</a>
    </li>
    <li>
      <a href="../articles/acceleration-filtering.html">Complementary filtering for acceleration: low- &amp; high-frequency</a>
    </li>
    <li>
      <a href="../articles/data-quality-error-correction.html">Data quality &amp; error correction</a>
    </li>
    <li>
      <a href="../articles/detectors-draft.html">detectors draft</a>
    </li>
    <li>
      <a href="../articles/dive-stats.html">Using dive_stats</a>
    </li>
    <li>
      <a href="../articles/find-dives.html">Using find_dives</a>
    </li>
    <li>
      <a href="../articles/fine-scale-tracking.html">Fine-scale tracking</a>
    </li>
    <li>
      <a href="../articles/install-load-tagtools.html">Installing and loading tagtools</a>
    </li>
    <li>
      <a href="../articles/jerk-transients.html">Jerk: a way to emphasize rapid changes in acceleration</a>
    </li>
    <li>
      <a href="../articles/load-tag-data.html">Load tag data</a>
    </li>
    <li>
      <a href="../articles/magnetometer-filtering.html">More complementary filtering: magnetometer &amp; dynamic acceleration</a>
    </li>
    <li>
      <a href="../articles/mahalanobis-distance.html">Mahalanobis distance</a>
    </li>
    <li>
      <a href="../articles/plots-and-cropping.html">Plots and cropping</a>
    </li>
    <li>
      <a href="../articles/rotation-test.html">Rotation test</a>
    </li>
    <li>
      <a href="../articles/tag-to-whale-frame.html">Tag orientation: From tag frame to sperm whale frame</a>
    </li>
    <li>
      <a href="../articles/vectors-vs-structures.html">Vectors and scalars versus structures</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="plots-and-cropping_files/header-attrs-2.10/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Plots and cropping</h1>
                        <h4 class="author">tagtools project team</h4>
            
            <h4 class="date">2021-08-18</h4>
      
      
      <div class="hidden name"><code>plots-and-cropping.Rmd</code></div>

    </div>

    
    
<p>Welcome to the plots and cropping vignette! On behalf of the team behind tagtools, thanks for taking some time to get to know our package. We hope it makes your life a little easier.</p>
<p>In this vignette, you will start to create some beautiful plots from the data we’ve been working with, as well as crop these to remove irrelevant data (e.g. before or after a tag was deployed on an animal).</p>
<p><em>Estimated time for this practical: 25 minutes.</em></p>
<p>These vignettes assume that you have some basic experience working with R/Rstudio, and can execute provided code, making some user-specific changes along the way. We will provide you with quite a few lines. To boost your own learning, you would do well to try and write them before opening what we give, using this just to check your work.</p>
<p>Additionally, be careful when copy-pasting special characters such as _underscores_ and ‘quotes’. If you get an error, one thing to check is that you have just single, simple underscores, and <code>'straight quotes'</code>, whether <code>'single'</code> or <code>"double"</code> (rather than “smart quotes”).</p>
<div id="setup-load-cats_test_raw-nc-as-a-large-list-mn" class="section level1">
<h1 class="hasAnchor">
<a href="#setup-load-cats_test_raw-nc-as-a-large-list-mn" class="anchor"></a>Setup: load “cats_test_raw.nc” as a large list, <code>MN</code>
</h1>
<p>If you’ve already completed <code>load-tag-data</code> within the same R session, you can skip down a bit to <a href="#exploratory-data-plots">Exploratory data plots</a>. If not, don’t worry! We’ll catch you up with code below.</p>
<p>For this example, we will make use of a CATS tag data file that is already stored in a .nc file called ‘cats_test_raw.nc’. This dataset is built into the <code>tagtools</code> package, so you can access it using <code>system.file</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">tagtools</span><span class="op">)</span>
<span class="va">cats_file_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"cats_test_raw.nc"</span>, package <span class="op">=</span> <span class="st">"tagtools"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">MN</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_nc.html">load_nc</a></span><span class="op">(</span><span class="va">cats_file_path</span><span class="op">)</span></code></pre></div>
</div>
<div id="exploratory-data-plots" class="section level1">
<h1 class="hasAnchor">
<a href="#exploratory-data-plots" class="anchor"></a>Exploratory data plots</h1>
<p>The tag toolbox has a function for plotting tag sensor data without getting it out of the structure:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plott.html">plott</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Depth <span class="op">=</span> <span class="va">MN</span><span class="op">$</span><span class="va">Depth</span>, Acceleration <span class="op">=</span> <span class="va">MN</span><span class="op">$</span><span class="va">Acc</span>, Gyroscope <span class="op">=</span> <span class="va">MN</span><span class="op">$</span><span class="va">Gyr</span><span class="op">)</span>, interactive <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<button class="btn btn-primary" data-toggle="collapse" data-target="#plott1">
Show/Hide Results
</button>
<div id="plott1" class="collapse">
<p><img src="plott_1.png" width="1014"></p>
</div>
<p>Notice that there are two t’s in this function name: <code><a href="../reference/plott.html">plott()</a></code>. <code><a href="../reference/plott.html">plott()</a></code> is a general purpose tag data plotter; a few of its key features are:</p>
<ul>
<li>For depth data, automatically plots on a reversed y-axis: increasing depths going downwards. This is nicer for visualizing a dive as actually going down, and ascent as actually going up, on your screen.</li>
<li>“t” stands for “time”; plot<em>t</em> also automatically converts the horizontal axis to a convenient time unit like hours or days instead of seconds, or a date-time if the recording start time is given.</li>
<li>If input <code>interactive</code> is set to TRUE (as in the code above), you can zoom in and out of data using keyboard entries.<br>
</li>
<li>The first input to <code><a href="../reference/plott.html">plott()</a></code> is the data, which must be in the form of a list (of sensor data lists or of matrices/vectors). Be careful with your data inputs, since, as in the code above, these are often contained within structures. Rather than typing just the variable <code>Depth</code>, it was important that you put <code>MN$depth</code>.</li>
<li>If the list items are named, the names will be used as axis labels.</li>
</ul>
<p>For more features and info, run the help function <code><a href="https://rdrr.io/r/utils/Question.html">?</a></code> with plott:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">?</span> <span class="va">plott</span></code></pre></div>
</div>
<div id="cropping-data-from-a-plot" class="section level1">
<h1 class="hasAnchor">
<a href="#cropping-data-from-a-plot" class="anchor"></a>Cropping data from a plot</h1>
<p>Not all tags have a way to start logging as soon as the tag has been deployed on the animal. Often data logging is started by a time trigger or alarm, and the researcher has to make a guess as to when the tag will be deployed to set its start time appropriately. Often this means that a tag is logging data before it is put on an animal. By the same token, tags have no means of detecting when they release from the tagged animal. As a consequence, they may continue to log data after they release. In most cases, the logged data from before and after deployment has no use. To reduce the data to just the periods when the tag is on the animal, use the tool <code><a href="../reference/crop.html">crop()</a></code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Pc</span> <span class="op">=</span> <span class="fu"><a href="../reference/crop.html">crop</a></span><span class="op">(</span><span class="va">MN</span><span class="op">$</span><span class="va">Depth</span><span class="op">)</span></code></pre></div>
<button class="btn btn-primary" data-toggle="collapse" data-target="#crop1">
Show/Hide Results
</button>
<div id="crop1" class="collapse">
<p><img src="crop_1.png" width="458"></p>
<pre><code>#&gt; [1] "Position your cursor and then click once followed by clicking FINISH to change the start, or click twice in the same spot followed by clicking FINISH to change the end. If you wish to change both the start and end click once at the start time desired and twice at the end time desired."</code></pre>
</div>
<p>This displays an interactive depth plot. (It does not know to reverse the y-axis, so that’s why it looks upside down.) Follow the instructions to select the obvious diving section of the data and then click finish. Alternatively, if you click once on your desired left limit and twice on your desired right limit, finish will click itself and the cropping will be complete. The function returns a new data structure which contains just the selected part of the dive profile.</p>
<p>Once you’ve cropped the depth data to the relevant segment, this will be stored as Pc. Now, use <code>plott</code> to plot Pc to make sure you cropped it correctly.</p>
<p>(<em>Now would be an especially good time to try and write the code yourself, since you’ve used <code>plott</code> once before. Hint: remember that the input to X should be a list.</em>)</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plott.html">plott</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Depth <span class="op">=</span> <span class="va">Pc</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<button class="btn btn-primary" data-toggle="collapse" data-target="#plott2">
Show/Hide Results
</button>
<div id="plott2" class="collapse">
<p><img src="plots-and-cropping_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
<p>If all has gone well, your plott should be absolutely beautiful.</p>
<p>As an alternative to <code>crop</code>, if you already know the start and end times (with appropriate units) that you would like to crop the data to, you can use <code>crop_to</code>. For instance, to get back something like what you just did with <code>crop</code> from the same depth data:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Pc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/crop_to.html">crop_to</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">MN</span><span class="op">$</span><span class="va">Depth</span>, tcues<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">111195040</span>, <span class="fl">155520000</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The resulting sensor data list also contains fields that document what you just did. They should look like:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Pc</span><span class="op">$</span><span class="va">history</span></code></pre></div>
<button class="btn btn-primary" data-toggle="collapse" data-target="#Pc_history">
Show/Hide Results
</button>
<div id="Pc_history" class="collapse">
<pre><code>#&gt; [1] "read_cats,crop_to"</code></pre>
</div>
<p>The history keeps track of the operations that you perform on a data structure. This helps with traceability if you make the processed data available in an archive. The crop and start_time fields show how the original data was changed: the <code>start_time</code> is with respect to the field <code>dephist_device_datetime_start</code> in the info structure which says when the tag recording started.</p>
</div>
<div id="review" class="section level1">
<h1 class="hasAnchor">
<a href="#review" class="anchor"></a>Review</h1>
<p>You’ve learned how to make plots using the <code>tagtools</code> function <code>plott</code>, as well as how to crop these plots.</p>
<p>Congratulations! You’ve completed this vignette.</p>
<p><em>If you’d like to continue working through these vignettes, <code>data-quality-error-correction</code> is probably a good option. In it, you’ll start to use some unique data processing tools that <code>tagtools</code> provides.</em></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html">vignette</a></span><span class="op">(</span><span class="st">'data-quality-error-correction'</span>, package <span class="op">=</span> <span class="st">'tagtools'</span><span class="op">)</span></code></pre></div>
<p><em>Or, you might consider <code>tag-to-whale-frame</code>. This vignette deals with one specific problem in error correction: orienting the data in the animal’s frame of reference (when, for various reasons, it may have been oriented in a different frame of reference).</em></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html">vignette</a></span><span class="op">(</span><span class="st">'tag-to-whale-frame'</span>, package <span class="op">=</span> <span class="st">'tagtools'</span><span class="op">)</span></code></pre></div>
<hr>
<p>Animaltags home pages: <a href="http://animaltags.org/" class="uri">http://animaltags.org/</a> (old), <a href="https://animaltags.netlify.app/" class="uri">https://animaltags.netlify.app/</a> (new), <a href="https://github.com/stacyderuiter/TagTools" class="uri">https://github.com/stacyderuiter/TagTools</a> (for latest beta source code), <a href="https://stacyderuiter.github.io/TagTools/articles/TagTools" class="uri">https://stacyderuiter.github.io/TagTools/articles/TagTools</a> (vignettes overview)</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Stacy DeRuiter, Mark Johnson, David Sweeney, Ye Joo McNamara-Oh, Samuel Fynewever, (Oghenkevwe) Racheal Tejevbo, Tiago Marques.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
