<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using find_dives • tagtools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using find_dives">
<meta property="og:description" content="tagtools">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tagtools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="find-dives_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using find_dives</h1>
                        <h4 class="author">tagtools project team</h4>
            
            <h4 class="date">2021-07-28</h4>
      
      
      <div class="hidden name"><code>find-dives.Rmd</code></div>

    </div>

    
    
<p>Welcome to this vignette! On behalf of the team behind tagtools, thanks for taking some time to get to know this package. We hope it is useful to you.</p>
<p>In this vignette you will learn to use <code>find_dives</code> to gain insight about a depth profile, calculate the mean dive duration and mean dive depth, and mark the beginnings and endings of dives.</p>
<p><em>Estimated time for this vignette: 20 minutes.</em></p>
<p>These practicals all assume that you have R/Rstudio, some basic experience working with them, and can execute provided code, making some user-specific changes along the way (e.g. to help R find a file you downloaded). We will provide you with quite a few lines. To boost your own learning, you would do well to try and write them before opening what we give, using this just to check your work.</p>
<p>Additionally, be careful when copy-pasting special characters such as _underscores_ and ‘quotes’. If you get an error, one thing to check is that you have just a single, simple underscore, and <code>'straight quotes'</code>, whether <code>'single'</code> or <code>"double"</code> (rather than “smart quotes”).</p>
<div id="load-the-test-data-set" class="section level1">
<h1 class="hasAnchor">
<a href="#load-the-test-data-set" class="anchor"></a>Load the test data set</h1>
<p>Load the test dataset <code>mn12_186a_raw.nc</code>. This dataset has already been converted from the source file that was offloaded from the tag into a NetCDF file. In doing so, some metadata was gleaned from the file and added to the data. Other metadata was added by hand. This dataset is built into the <code>tagtools</code> package, so you can access it using <code>system.file</code>.</p>
<p>Use load_nc to load a NetCDF file:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">tagtools</span><span class="op">)</span>
<span class="va">MN_file_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"mn12_186a_raw.nc"</span>, package <span class="op">=</span> <span class="st">"tagtools"</span>, mustWork <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">MN</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_nc.html">load_nc</a></span><span class="op">(</span><span class="va">MN_file_path</span><span class="op">)</span></code></pre></div>
<p>This creates an animaltag list object MN in your workspace. You can view it in the Environment tab if working in RStudio, or in the command line type:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">MN</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">MN</span><span class="op">$</span><span class="va">A</span><span class="op">)</span>
<span class="co"># not run because output is very long! see the whole STRucture of MN:</span>
<span class="co"># str(MN)</span>
<span class="co"># shorter outline version:</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">MN</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<button class="btn btn-primary" data-toggle="collapse" data-target="#inspect_MN">
Show/Hide Results
</button>
<div id="inspect_MN" class="collapse">
<pre><code>#&gt; [1] "Results for `names(MN)`:"
#&gt; [1] "------------------------"
#&gt; [1] "P"    "A"    "M"    "T"    "S"    "info"
#&gt; [1] "Results for `str(MN$A)`:"
#&gt; [1] "------------------------"
#&gt; List of 19
#&gt;  $ data              : num [1:1172115, 1:3] 2355 2340 2324 2315 2296 ...
#&gt;  $ sampling          : chr "regular"
#&gt;  $ sampling_rate     : num 32
#&gt;  $ sampling_rate_unit: chr "Hz"
#&gt;  $ depid             : chr "mn12_186a"
#&gt;  $ creation_date     : chr "07-Aug-2017 14:51:46"
#&gt;  $ history           : chr "read_ll3m"
#&gt;  $ type              : chr "acc"
#&gt;  $ full_name         : chr "Acceleration"
#&gt;  $ description       : chr "triaxial acceleration"
#&gt;  $ unit              : chr "1"
#&gt;  $ unit_name         : chr "counts"
#&gt;  $ unit_label        : chr "counts"
#&gt;  $ start_offset      : num 0
#&gt;  $ start_offset_units: chr "second"
#&gt;  $ column_name       : chr "x,y,z"
#&gt;  $ frame             : chr "tag"
#&gt;  $ axes              : chr "FRU"
#&gt;  $ files             : chr "20120704-57537-Mn-XXXX-U-NoName-Acceleration-X.TXT20120704-57537-Mn-XXXX-U-NoName-Acceleration-Y.TXT20120704-57"| __truncated__
#&gt; [1] "Results for `str(MN$A)`:"
#&gt; [1] "------------------------"
#&gt; List of 6
#&gt;  $ P   :List of 17
#&gt;  $ A   :List of 19
#&gt;  $ M   :List of 19
#&gt;  $ T   :List of 16
#&gt;  $ S   :List of 17
#&gt;  $ info:List of 25
#&gt;  - attr(*, "class")= chr [1:2] "animaltag" "list"</code></pre>
</div>
<p>You should see that lists <code>A</code>, <code>M</code>, <code>P</code>, <code>S</code>, <code>T</code> and <code>info</code> are contained within the list MN.</p>
</div>
<div id="exercise-calculate-the-mean-duration-of-dives-deeper-than-5m" class="section level1">
<h1 class="hasAnchor">
<a href="#exercise-calculate-the-mean-duration-of-dives-deeper-than-5m" class="anchor"></a>Exercise: Calculate the mean duration of dives deeper than 5m</h1>
<p>Our goal with these data is to calculate the mean duration of dives deeper than 5 m. If you can think of a way to do this already, please go ahead and try! You can then compare your answer to the step-by-step procedure below.</p>
<p>As with all raw depth data, there are some problems with this dive profile. Try and plot the depth profile and the temperature. Then, see if you can find evidence for each of these in the plot:</p>
<ol style="list-style-type: decimal">
<li>Incorrect calibration of the sensor</li>
<li>Occasional outliers</li>
<li>Coarse depth resolution</li>
<li>Temperature sensitivity</li>
</ol>
<button class="btn btn-primary" data-toggle="collapse" data-target="#ans_prob_with_prof">
<em>Show/Hide Answers</em>
</button>
<div id="ans_prob_with_prof" class="collapse">
<p><em>1. Pay attention to the depths reported… While it looks like a dive profile, mostly, what looks like the “surface” is actually around some </em><span class="math inline">\(-10\)</span> m <em>(that is, ten meters high in the air)! We know that humpback whales do not, in fact, go ten meters in the sky routinely. This suggests the sensor has not been well-calibrated.</em> <em>2. Occasionally, there are some peaks that go higher yet than these ten meters high in the sky momentarily (more like 15 meters). These are outliers.</em> <em>3. Zoom in to the shallow part of the dive to notice this. The individual measurements are only precise to the meter; thus it will appear to jump back and forth more suddenly than we would expect for a relaxed whale at the surface.</em> <!-- When y-axis limits in plott work: demonstrate with shallow depth. --> <em>4. The temperature gradually rises as the recording nears the end, then spikes down and up. This is accompanied by a gradually decreasing depth from ten meters in the sky to the surface. Together, the two trends strongly suggest that the depth data has been affected by the changing temperature as the tag sits near the surface. </em></p>
</div>
<div id="hints-tips" class="section level2">
<h2 class="hasAnchor">
<a href="#hints-tips" class="anchor"></a>Hints &amp; Tips</h2>
<ol style="list-style-type: decimal">
<li>Look in <code>info</code> to find what species the data come from. Are the depth values reasonable for this species?</li>
<li>Zoom in and see what size depth steps there are in the data.</li>
<li>Use <code>plott</code> to plot both the depth and temperature:</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plott.html">plott</a></span><span class="op">(</span>X<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Depth<span class="op">=</span><span class="va">MN</span><span class="op">$</span><span class="va">P</span>, Temperature<span class="op">=</span><span class="va">MN</span><span class="op">$</span><span class="cn">T</span><span class="op">)</span>, r<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>
<span class="co"># r=c(TRUE,FALSE) tells plot to reverse the y-axis for the Depth data (so that it looks like a dive profile), but not for the Temperature data (which would be silly). </span></code></pre></div>
<button class="btn btn-primary" data-toggle="collapse" data-target="#plott_MN">
Show/Hide Results
</button>
<div id="plott_MN" class="collapse">
<p><img src="find-dives_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
</div>
<div id="what-to-do-about-periods-of-data-when-the-tag-is-not-on-the-animal" class="section level2">
<h2 class="hasAnchor">
<a href="#what-to-do-about-periods-of-data-when-the-tag-is-not-on-the-animal" class="anchor"></a>What to do about periods of data when the tag is not on the animal</h2>
<p>Not all tags have a way to start logging as soon as the tag has been deployed on the animal. Often data logging is started by a time trigger or alarm, and the researcher has to make a guess as to when the tag will be deployed to set its start time appropriately. Often this means that a tag is logging data before it is put on an animal.</p>
<p>Equally, tags have no means of detecting when they release from the tagged animal. As a consequence, they may continue to log data after they release. In most cases, the logged data from before and after deployment has no use. To reduce the data to just the periods when the tag is on the animal, use the tool <code>crop</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Pc</span> <span class="op">=</span> <span class="fu"><a href="../reference/crop.html">crop</a></span><span class="op">(</span><span class="va">MN</span><span class="op">$</span><span class="va">P</span><span class="op">)</span></code></pre></div>
<button class="btn btn-primary" data-toggle="collapse" data-target="#Pc">
Show/Hide Results
</button>
<div id="Pc" class="collapse">
<p><img src="find-dives_files/figure-html/unnamed-chunk-8-1.png" width="700"><img src="find-dives_files/figure-html/unnamed-chunk-8-2.png" width="700"></p>
<pre><code>#&gt; [1] "Position your cursor and then click once followed by clicking FINISH to change the start, or click twice in the same spot followed by clicking FINISH to change the end. If you wish to change both the start and end click once at the start time desired and twice at the end time desired."</code></pre>
</div>
<p>This displays an interactive depth plot. Follow the instructions to select the obvious diving section of the data and then click finish. The function returns a new data structure which contains just the selected part of the dive profile. The resulting sensor data list also contains fields that document what you just did. To see them:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Pc</span><span class="op">$</span><span class="va">history</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">Pc</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<button class="btn btn-primary" data-toggle="collapse" data-target="#PcHistory">
Show/Hide Results
</button>
<div id="PcHistory" class="collapse">
<pre><code>#&gt; [1] "Results for `Pc$history`:"
#&gt; [1] "-------------------------------------"
#&gt; [1] "read_ll3m,crop_to"
#&gt; [1] "Results for `str(Pc, max.level = 1)`:"
#&gt; [1] "-------------------------------------"
#&gt; List of 21
#&gt;  $ data              : num [1:25306] -6.5 -6.5 -6.5 -6.5 -6.5 -6.5 -6.5 -6.5 -6.5 -7 ...
#&gt;  $ sampling          : chr "regular"
#&gt;  $ sampling_rate     : num 1
#&gt;  $ sampling_rate_unit: chr "Hz"
#&gt;  $ depid             : chr "mn12_186a"
#&gt;  $ creation_date     : chr "07-Aug-2017 14:51:49"
#&gt;  $ history           : chr "read_ll3m,crop_to"
#&gt;  $ type              : chr "press"
#&gt;  $ full_name         : chr "Pressure"
#&gt;  $ description       : chr "dive depth"
#&gt;  $ unit              : chr "m H2O"
#&gt;  $ unit_name         : chr "meters H2O (salt)"
#&gt;  $ unit_label        : chr "meters"
#&gt;  $ start_offset      : num 0
#&gt;  $ start_offset_units: chr "second"
#&gt;  $ axes              : chr "D"
#&gt;  $ files             : chr "20120704-57537-Mn-XXXX-U-NoName-Depth.TXT"
#&gt;  $ crop              : num [1:2] 0 25306
#&gt;  $ crop_units        : chr "seconds"
#&gt;  $ start_time        : num 0
#&gt;  $ start_time_units  : chr "seconds"</code></pre>
</div>
<p>The <code>$history</code> field keeps track of the operations that you perform on a data structure. This helps with traceability if you make the processed data available in an archive. The <code>$crop</code> and <code>$start_time</code> fields show how the original data was changed: the start_time is with respect to the field ‘dephist_device_datetime_start’ in the <code>$info</code> structure which says when the tag recording started. Use <code>plott</code> to plot Pc to make sure you cropped it correctly.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plott.html">plott</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>DepthCropped<span class="op">=</span><span class="va">Pc</span><span class="op">)</span>, r <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>Note that the results from here on out will look a little different depending on where exactly you’ve cropped your data, but it should come to essentially the same thing.</p>
<button class="btn btn-primary" data-toggle="collapse" data-target="#Pc_plott">
Show/Hide Results
</button>
<div id="Pc_plott" class="collapse">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plott.html">plott</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>DepthCropped<span class="op">=</span><span class="va">Pc</span><span class="op">)</span>, r <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="removing-outliers-" class="section level2">
<h2 class="hasAnchor">
<a href="#removing-outliers-" class="anchor"></a>Removing outliers.</h2>
<p>Outliers or spikes in the data may result from errors in the tag or poor sensor performance under rapidly changing environmental conditions. For example in this data set, rapid changes in temperature and pressure as the animal surfaces cause small glitches in the data. These are not representative of the animal’s behaviour so we need to remove them. A good way to do this is with a median filter. Type:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">?</span><span class="va">median_filter</span></code></pre></div>
<p>to find out how this function works. You call it using:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Pcm</span> <span class="op">=</span> <span class="fu"><a href="../reference/median_filter.html">median_filter</a></span><span class="op">(</span><span class="va">Pc</span>,n<span class="op">=</span><span class="fl">3</span><span class="op">)</span></code></pre></div>
<p>Your variable <code>Pcm</code> now contains the median-filtered, cropped depth data. Check its history to verify that the median filtering has been added. Compare it against the unfiltered data using:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plott.html">plott</a></span><span class="op">(</span>X<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Pc<span class="op">=</span><span class="va">Pc</span>, Pcm<span class="op">=</span><span class="va">Pcm</span><span class="op">)</span>, r<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
<button class="btn btn-primary" data-toggle="collapse" data-target="#Pc_pcm_plott">
Show/Hide Results
</button>
<div id="Pc_pcm_plott" class="collapse">
<p><img src="find-dives_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
</div>
<p>This plots <code>Pc</code> in the upper panel and <code>Pcm</code> in the lower one, and reverses the y-axis labeling on both plots (by setting <code>r</code> to TRUE both times).</p>
</div>
<div id="correcting-pressure-offsets-temperature-effects" class="section level2">
<h2 class="hasAnchor">
<a href="#correcting-pressure-offsets-temperature-effects" class="anchor"></a>Correcting pressure offsets &amp; temperature effects</h2>
<p>The next step is to correct the ‘0’ pressure offset of the depth sensor (so that the animal is not 10 m out of the water when it is really at the surface). We can also compensate for temperature at the same time. To do this we have to first crop the temperature data to match the pressure data. You can do this using:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Tc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/crop_to.html">crop_to</a></span><span class="op">(</span><span class="va">MN</span><span class="op">$</span><span class="cn">T</span>,tcues<span class="op">=</span><span class="va">Pc</span><span class="op">$</span><span class="va">crop</span><span class="op">)</span></code></pre></div>
<p>This uses the crop information stored in Pc to do the same operation on T. Plot them together to confirm that the time intervals (horizontal ticks) are the same:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plott.html">plott</a></span><span class="op">(</span>X<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Pcm<span class="op">=</span><span class="va">Pcm</span>, Tc<span class="op">=</span><span class="va">Tc</span><span class="op">)</span>, r<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<button class="btn btn-primary" data-toggle="collapse" data-target="#Pc_Tc_plott">
Show/Hide Results
</button>
<div id="Pc_Tc_plott" class="collapse">
<p><img src="find-dives_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
</div>
<p>The tag toolbox has a function to correct pressure data called ‘fix_pressure’. Type</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">?</span> <span class="va">fix_pressure</span></code></pre></div>
<p>to find out what it does and what assumptions it makes about the data. Use this function by calling:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Pcmf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fix_pressure.html">fix_pressure</a></span><span class="op">(</span><span class="va">Pcm</span>, <span class="va">Tc</span><span class="op">)</span></code></pre></div>
<p>Compare the compensated dive profile to the uncompensated cropped ones using plott. (The code below will produce three plots, which might make them a bit small. Hit “Zoom” to view them in a larger window.)</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plott.html">plott</a></span><span class="op">(</span>X<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Pc<span class="op">=</span><span class="va">Pc</span>, Pcm<span class="op">=</span><span class="va">Pcm</span>, Pcmf<span class="op">=</span><span class="va">Pcmf</span><span class="op">$</span><span class="va">p</span><span class="op">)</span>, r<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">TRUE</span>,<span class="cn">TRUE</span>,<span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<button class="btn btn-primary" data-toggle="collapse" data-target="#Pc_Pcm_Pcmf_plott">
Show/Hide Results
</button>
<div id="Pc_Pcm_Pcmf_plott" class="collapse">
<p><img src="find-dives_files/figure-html/unnamed-chunk-24-1.png" width="700"></p>
</div>
<p>Which of the problems that we listed above have been taken care of? Any ideas what you could do about the remaining one(s)?</p>
<button class="btn btn-primary" data-toggle="collapse" data-target="#ans_probs_addressed_or_naw">
<em>Show/Hide Answers</em>
</button>
<div id="ans_probs_addressed_or_naw" class="collapse">
<p><em>1. Incorrect calibration of the sensor and temperature sensitivity have both been addressed by now, since the whale is actually resting and breathing at the surface, rather than ten meters in the air. Additionally, some of the occasional outliers have been removed by the median filter.</em></p>
<p><em>However, none of this has increased the resolution of the depth data. In order to resolve this last issue, ultimately, new data would have to be taken at higher resolution.</em></p>
</div>
</div>
<div id="finding-dives-the-mean-dive-duration" class="section level2">
<h2 class="hasAnchor">
<a href="#finding-dives-the-mean-dive-duration" class="anchor"></a>Finding dives &amp; the mean dive duration</h2>
<p>To find the mean dive duration for dives over 5 m in depth, you could measure each dive by hand on the <code>depth</code> plot (<code>ginput</code> is a useful function in Matlab and Octave for measuring data on a plot – there isn’t a great equivalent in R, where interactive plots are not really commonly used). But there is a toolbox function for this called <code>find_dives</code>. See the help on this function to find out what it does and what options it has.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">?</span> <span class="va">find_dives</span></code></pre></div>
<p>To find dives deeper than 5 m in your compensated dive data, type:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_dives.html">find_dives</a></span><span class="op">(</span><span class="va">Pcmf</span><span class="op">$</span><span class="va">p</span>,mindepth<span class="op">=</span><span class="fl">5</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">d</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<button class="btn btn-primary" data-toggle="collapse" data-target="#find_dives_d">
Show/Hide Results
</button>
<div id="find_dives_d" class="collapse">
<pre><code>#&gt; 'data.frame':    53 obs. of  4 variables:
#&gt;  $ start: num  2392 2604 3165 3626 4023 ...
#&gt;  $ end  : num  2481 2778 3361 3877 4213 ...
#&gt;  $ max  : num  6.88 11.99 11.51 50.11 23.53 ...
#&gt;  $ tmax : num  2434 2649 3205 3741 4078 ...</code></pre>
</div>
<p><code>d</code> should return a data frame with the start, end, and maximum depth of about 51 dives (depending on where you cropped the data). How can you get the mean dive duration &amp; mean (maximum) dive depth from this structure? Code below provides one possible answer.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">total_dive_duration</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">n</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">total_dive_duration</span> <span class="op">&lt;-</span> <span class="va">total_dive_duration</span> <span class="op">+</span> <span class="va">d</span><span class="op">[</span><span class="va">n</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="va">d</span><span class="op">[</span><span class="va">n</span>,<span class="fl">1</span><span class="op">]</span>
  <span class="op">}</span>
<span class="va">mean_dive_duration</span> <span class="op">&lt;-</span> <span class="va">total_dive_duration</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span>
<span class="va">mean_dive_duration</span>
<span class="co"># since this is using data from find_dives, the mean duration is in seconds</span>
<span class="co"># and mean depth</span>
<span class="va">total_dive_depth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">n</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">total_dive_depth</span> <span class="op">&lt;-</span> <span class="va">total_dive_depth</span> <span class="op">+</span> <span class="va">d</span><span class="op">[</span><span class="va">n</span>,<span class="fl">3</span><span class="op">]</span>
<span class="op">}</span>
<span class="va">mean_dive_depth</span> <span class="op">&lt;-</span> <span class="va">total_dive_depth</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span>
<span class="va">mean_dive_depth</span></code></pre></div>
<p>When you have got the mean dive depth, try plotting the start and end of the dives on the depth plot:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plott.html">plott</a></span><span class="op">(</span>X<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Pcmf<span class="op">=</span><span class="va">Pcmf</span><span class="op">$</span><span class="va">p</span><span class="op">)</span>, r<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">start</span><span class="op">/</span><span class="op">(</span><span class="fl">3600</span><span class="op">*</span><span class="fl">24</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">)</span>,col<span class="op">=</span><span class="st">'green'</span>, pch<span class="op">=</span><span class="fl">19</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">end</span><span class="op">/</span><span class="op">(</span><span class="fl">3600</span><span class="op">*</span><span class="fl">24</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">)</span>,col<span class="op">=</span><span class="st">'red'</span>, pch<span class="op">=</span><span class="fl">17</span><span class="op">)</span></code></pre></div>
<button class="btn btn-primary" data-toggle="collapse" data-target="#start_end_dives">
Show/Hide Results
</button>
<div id="start_end_dives" class="collapse">
<p><img src="find-dives_files/figure-html/unnamed-chunk-30-1.png" width="700"></p>
</div>
<p>Again, this plot might be rather small. As a result it might be tricky to make sense of the markers that designate the starts and ends of dives. You should be able to click Zoom to view the plot in a larger window.</p>
<p>Note: if you cropped the time such that the units of the x-axis are not in days, you will have to adjust the multipliers in the <code>points</code> code accordingly. In the example above, the start and end times returned by find_dives are in seconds so we needed to divide them by 3600*24 to match the unit (days) automatically selected for time by <code>plott</code>.</p>
</div>
</div>
<div id="review" class="section level1">
<h1 class="hasAnchor">
<a href="#review" class="anchor"></a>Review</h1>
<p>Great work! You’ve learned how to use <code>find_dives</code>.</p>
<p><em>If you’d like to continue working through these practicals, <code>dive-stats</code> might be a good option if you’re especially interested in analyzing individual dives. Otherwise, consider <code>fine-scale-tracking</code> or <code>mahalanobis-distance</code>.</em></p>
<hr>
<p>Animaltags home pages: <a href="http://animaltags.org/" class="uri">http://animaltags.org/</a> (old), <a href="https://animaltags.netlify.app/" class="uri">https://animaltags.netlify.app/</a> (new), <a href="https://github.com/stacyderuiter/TagTools" class="uri">https://github.com/stacyderuiter/TagTools</a> (for source code)</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Stacy DeRuiter.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
